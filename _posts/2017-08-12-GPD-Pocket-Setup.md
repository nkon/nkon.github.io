---
layout: post
title: GPD Pocket の環境整備
category: blog
tags: blog, gpd_pocket, windows10, bash_on_windows, docker, docker_for_windows, rust, python
---

GPD Pocket を購入したので設定メモ。Windows10を使うのも初めてということもあり、前半はGPD Pocket 特有の話も書いてあるが、後半はWindows10の環境構築の話がメインになってしまった。

# 初期設定
Wiki(http://gpd.wiki)[http://gpd.wiki] ができて情報が集約されているので、まずはそちらを参照する。
* Wifi driverの更新


# 処理能力
* マルチタスク的な状況だと重さを感じる。たとえば、ブラウザを起動して複数のページを処理しているときとか、Facebookのウェブページとか。
* タスクマネージャで見るとCPU は4つ見える。

## 既知の不具合と対策
* 蓋を閉じているのにスリープから覚める→ホールセンサの異常が疑われる。レジストリを編集して設定を出し，蓋を開いたときの動作を「何もしない」にする。
* スリープ時に勝手に覚める→スリープから休止状態になろうとして失敗して起動してしまう。
    + 休止状態の削除(powercfg /hibernate off'): たぶん初期設定でそうなっていると思うが、何かの拍子に有効になっていたら。
    + Wifiドライバの手動更新。
    + レジストリを編集して設定を出し、IO一体化タイムアウトの設定を変更する。
* System task が30%ほど電力を食い続ける→Intel DPTF ドライバの不良。最新のWindows Update で直っている(8.3.10205.4743 [2017/06/22])？
* 30%以上にCPUが回らない→BIOSの不具合？ 2017/07/03より以前のBIOSにすれば治る？ 2017-08-16時点では対策中？ 熱すぎることが原因なので、そうなったら電源を切って冷ますしかない？
    + 休止状態の削除。BTマウスが動いてしまうとスリープから解除されてしまうので、忘れずにマウスの電源を切る。または、トラックポイントに慣れよう。


# バッテリー＆スリープ
MIROさんの記事に従ってレジストリを編集し、電源オプションでカバーを開いたときのアクションを設定できるようにして「何もしない」にすればOK。ちゃんとスリープ(メモリを保持)＆休止(ディスクにメモリを書き出す)してくれるし、ちょっと使いには十分バッテリーが持つ。3時間ぐらいが実用か？
スリープから勝手に起動してしまう場合はWifiドライバの手動更新と、IO一体化タイムアウトのレジストリ編集で治ると思う。
休止からの復帰は、上述の30% 問題があるので、スリープでの運用が推奨されている。

ただし、Bluetooth接続のマウスを使っている場合、マウスを動かすとスリープが解除されてしまう。スリープ前にマウスの電源をOFFにするのを忘れないようにしよう。


<div align="center"><img src="/images/2017-08-12-gpd-pocket-power-plan1.png" alt="powerplan"><img src="/images/2017-08-12-gpd-pocket-power-plan2.png" alt="powerplan"></div>

# キーボード、ポインタ
自宅ではUbuntu+Realforce(JIS配列,かな入力,Mozc,変換/無変換でIME ON/OFF)、有線Microsoft Mouse。勤務先ではLet's Note+Windows 7(JIS配列,ローマ字入力,MS-IME, Alt+漢字でIME ON/OFF')、ホイールパッド(ホイールスクロールやタップを無効)、という構成。

GPD Pocket の偽ASCII配列、Shift+CapsでIMEのON/OFFは慣れるのが大変。どうしても見ながらタイプになってしまう。キーのタッチは軽くてシャープでよいが、キーのエッジが多少ひっかかる。キー表面もざらっとしていて、私はツルッとしているのが好みだ。

AutoHotKey を使って、キー配列をカスタマイズした。
* `AppsKey::MButton` アプリケーションキー(スペースキーの右にある[三])をマウスのミドルボタンに割り当ててスクロールさせる。
* `RAlt::Send, {vkF3sc029}` 右ALTキーを、全角半角キーに割り当てて、IMEのON/OFFを右ALTキーで行う。
* `CapsLock::Tab`, `Tab::CapsLock` TABとCapsLockを入れ替える。本来、TABはQの左だが、Aの左のほうがまだマシ。コマンドラインの補完で使用頻度が高い。
* `Delete::Backspace`,`Backspace::Delete` BS と Del だとBSの方が使用頻度が高いので、電源キーより遠いところに配置する。そもそも、通常のキーボードでは、Enterの上はBS。

BSキーと電源が近接しているのは殺意を覚えることがしばしばある。

一方、ポインタは、かつてTrackPadを使っていたこともあって非常に快適。カーソルの設定を早めに変更しておくこと、これもネットで紹介されていた設定だが、メニューキーをマウススクロールに割り当てることで快適に使用できる。自宅での使用のためにBluetoothマウスを買ったが、無くても大丈夫なぐらい。標準ポインタでも十分使えるが、ネットで推奨されているThinkPadのロープロファイルポインタに変更すればさらに素晴らしい。ブームに便乗した小売店が高値を付けているが、補修部品をきちんと供給しているLenovoに敬意を示す意味でも、10個入りを正規ルートで購入するべきだろう。

# 周辺機器

## headset
3.5mmのヘッドホンジャックがある。電車の中などで動画を見る場合はヘッドホンが必要。付属のヘッドホン(3.5mmステレオ)はちゃんと動作するが、手持ちのヘッドセット(サンワサプライ製のCTIA規格、マイク+Talkスイッチ付き)を挿したらうまく動作しない。OMTP規格でバイアスが供給されている疑いが。

## USB Type-C
充電専用？ 喜び勇んでType-C HUBを買ってみたが動作せず。PD HUBとしても動作しないし、バスパワーの普通のHUBとしても認識しない。外部デバイスの接続はType-A(複数必要ならHUB)、外部ディスプレイはMicroHDMIの変換コネクタ、入力インフェースはBluetoothが妥当だろう。

## ディスプレイ
1920×1200の解像度を誇るが7インチは老眼にはつらい。幸い、Windows10はディスプレイスケーリングが効果的なので150%の設定で使用中。実質1280×800だ。125%ではつらい。製品に保護シートが付属するが、Visaviの非光沢タイプを買った。非光沢アンチグレアが好きだし、形がピッタリで全く存在感を忘れる。

microHDMI-HDMK変換コネクタ、microUSB-TypeC 変換コネクタは安いし小さいので持っておくとよいだろう。

# Windows10
後述のとおり、Docker for Windowsを使いたいのでHomeからProにアップデートした。ストアで購入可能だ。

ほとんど、初Windows10。色々と新機能があって便利になっている。

## PowerShell
強力らしいし、歩み寄ろうとしてくれる努力も感じられるが、全くなじめない。デフォルトではビープがうるさくて、それを消すためには設定ファイルが必要で、設定ファイルを有効にするために権限変更が必要とは、ハードル高すぎるだろう。

## chocolaty
apt みたいなもの。登録されているアプリの場合、コマンド一発でインストール&アップデートできる。便利すぎる。そういったのを統一的に扱うためにPowerShell上のPackageManagementというのもあるらしいがうまく動かなかった。今回は知らずにインストールしたアプリが多いが、次は真っ先に chocolaty を入れて、cinstしまくる予定。

## Bash on Windows(Linux Subsystem for Windows)
クライアントLinux環境は、仮想PCではなく、ここに構築することにした。GUIアプリもXserverを立てればOK。全部apt-getで入る。
コマンドラインだけなら容量はあまり食わない。日本語入力はWindows側のIMEで可能なので、UTF-8の日本語ファイルの編集もVimなどで可能だ。
GUIアプリもXサーバ経由で使えるのでインストールした。Windows側のXserverはXmingが有名だがVcXsrv の方が近年の評価が高い。

## Docker for Windows
サーバ環境はDocker for Windowsを使ってみた。VirtualBoxでも動作可能だと思うが、今さらサーバをapt-getでバージョン管理したくないので。起動に時間がかかる。Docker for Windowsの性能か、Atom-ZのHyper-V性能が悪いのかは不明。ときどき不安定でDockerが死ぬことがあるが、一応は使えている。

VirtualBox とスリープの相性問題も報告されており、通常の仮想マシンを使うにしてもHyper-Vにというのもある。

## Python
Anaconda を入れた。

## Rust
公式に従って rustup-init.exe で入る。以後は rustup にお任せ。Windowsの場合は Visual C++ Build Tool を入れておく必要がある。

## Node.js
* Node.js を入れてその上にtextlint、VS Code で執筆環境はOK。

## その他
* DLWアクセスランプというタスクトレイでディスクとネットのアクセスをモニタ出来るツール。
* 純正ケースも購入。ピッタリなのが具合良い。
